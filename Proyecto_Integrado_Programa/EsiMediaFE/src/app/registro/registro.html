<div class="auth-card">
  <h2>Crear Cuenta</h2>

  <form #f="ngForm" (ngSubmit)="onSubmit(f)">

    <input class="input"
           name="nombre"
           [(ngModel)]="nombre"
           required
           #nombreModel="ngModel"
           [disabled]="isLoading"
           [ngClass]="{'input-error': nombreModel.invalid && nombreModel.dirty}"
           placeholder="Nombre *">
    <small class="error-msg" *ngIf="nombreModel.invalid && nombreModel.dirty">Falta el nombre</small>

    <input class="input"
           name="apellidos"
           [(ngModel)]="apellidos"
           required
           #apellidosModel="ngModel"
           [disabled]="isLoading"
           [ngClass]="{'input-error': apellidosModel.invalid && apellidosModel.dirty}"
           placeholder="Apellidos *">
    <small class="error-msg" *ngIf="apellidosModel.invalid && apellidosModel.dirty">Faltan los apellidos</small>

    <input class="input"
           name="email"
           type="email"
           [(ngModel)]="email"
           required
           [pattern]="emailPattern.source"
           #emailModel="ngModel"
           [disabled]="isLoading"
           [ngClass]="{'input-error': emailModel.invalid && emailModel.dirty}"
           placeholder="Email *">
    <small class="error-msg" *ngIf="emailModel.errors?.['required'] && emailModel.dirty">Falta el email</small>
    <small class="error-msg" *ngIf="emailModel.errors?.['pattern'] && emailModel.dirty">Email no vÃ¡lido</small>
   
    <input class="input" name="alias" [(ngModel)]="alias" [disabled]="isLoading" placeholder="Alias (opcional)">


    <input class="input"
           name="fechaNac"
           type="date"
           [(ngModel)]="fechaNac"
           required
           #fechaModel="ngModel"
           [disabled]="isLoading"
           [ngClass]="{'input-error': (fechaModel.invalid && fechaModel.dirty) || (fechaModel.dirty && fechaInvalida)}"
           placeholder="Fecha Nacimiento *">
    <small class="error-msg" *ngIf="fechaModel.errors?.['required'] && fechaModel.dirty">Falta la fecha de nacimiento</small>
    <small class="error-msg" *ngIf="fechaModel.dirty && fechaInvalida">La fecha no puede ser futura</small>


    <select class="input role-select"
            name="role"
            [(ngModel)]="role"
            required
            #roleModel="ngModel"
            [disabled]="isLoading"
            [ngClass]="{'input-error': roleModel.invalid && roleModel.dirty}">
      <option value="" disabled selected>Selecciona un rol *</option>
      <option value="usuario">Usuario</option>
      <option value="Gestor de Contenido">Gestor de Contenido</option>
      <option value="Administrador">Administrador</option>
    </select>
    <small class="error-msg" *ngIf="roleModel.invalid && roleModel.dirty">Selecciona un rol</small>

    <div class="password-field">
      <input class="input"
             [type]="showPwd ? 'text' : 'password'"
             name="pwd"
             [(ngModel)]="pwd"
             required
             minlength="8"
             #pwdModel="ngModel"
             [disabled]="isLoading"
             [ngClass]="{'input-error': (pwdModel.invalid && pwdModel.dirty) || (pwdModel.dirty && pwdIssues.length>0)}"
             placeholder="ContraseÃ±a *">
      <button type="button" class="toggle-eye" (click)="togglePwd()" [disabled]="isLoading">
        {{ showPwd ? 'ğŸ™ˆ' : 'ğŸ‘ï¸' }}
      </button>
    </div>
    <small class="error-msg" *ngIf="pwdModel.errors?.['required'] && pwdModel.dirty">Falta la contraseÃ±a</small>


    <ul class="error-list" *ngIf="pwdModel.dirty && pwdIssues.length">
      <li *ngFor="let r of pwdIssues" class="error-msg">â€¢ {{ r }}</li>
    </ul>
    <div class="strength-wrapper" *ngIf="pwd.length">
      <div class="strength-bar" [class.s1]="pwdScore===1" [class.s2]="pwdScore===2"
           [class.s3]="pwdScore===3" [class.s4]="pwdScore===4"></div>
      <small class="strength-label">Fuerza: {{ pwdStrengthLabel }}</small>
    </div>
        
    <small class="info-msg" *ngIf="isCheckingPwned && pwd.length">Comprobando contraseÃ±a...</small>
    <small class="error-msg" *ngIf="!isCheckingPwned && (pwnedCount || 0) > 0">
      Esta contraseÃ±a aparece en filtraciones {{ pwnedCount }} veces. Elige otra distinta.
    </small>
    <small class="ok-msg" *ngIf="!isCheckingPwned && pwd.length && pwnedCount === 0">
      Esta contraseÃ±a no aparece en el diccionario de contraseÃ±as comprometidas.
    </small>

    <div class="password-field">
      <input class="input"
             [type]="showPwd2 ? 'text' : 'password'"
             name="pwd2"
             [(ngModel)]="pwd2"
             required
             #pwd2Model="ngModel"
             [disabled]="isLoading"
             [ngClass]="{'input-error': (pwd2Model.invalid && pwd2Model.dirty) || (pwd2Model.dirty && pwdMismatch)}"
             placeholder="Repetir ContraseÃ±a *">
      <button type="button" class="toggle-eye" (click)="togglePwd2()" [disabled]="isLoading">
        {{ showPwd2 ? 'ğŸ™ˆ' : 'ğŸ‘ï¸' }}
      </button>
    </div>
    <small class="error-msg" *ngIf="pwd2Model.errors?.['required'] && pwd2Model.dirty">Falta confirmar la contraseÃ±a</small>
    <small class="error-msg" *ngIf="pwd2Model.dirty && pwdMismatch">Las contraseÃ±as no coinciden</small>

    <label class="chkline">
      <input type="checkbox" [(ngModel)]="vip" name="vip" [disabled]="isLoading">
      Â¿Quiere usted ser VIP?
    </label>


    <div class="file-upload">
      <label for="foto">Foto de perfil (mÃ¡x 2MB):</label>
      <input type="file" id="foto" (change)="onFileChange($event)" [disabled]="isLoading">
    </div>


    <label class="chkline terms">
      <input type="checkbox" [(ngModel)]="termsAccepted" name="termsAccepted" [disabled]="isLoading" required>
      Acepto los <a href="#" target="_blank">TÃ©rminos</a> y la <a href="#" target="_blank">PolÃ­tica de Privacidad</a> *
    </label>


    <button class="btn" type="submit"
            [disabled]="isLoading || f.invalid || pwdIssues.length>0 || pwdMismatch || fechaInvalida || !termsAccepted">
      <span *ngIf="!isLoading">Registrar</span>
      <span *ngIf="isLoading" class="spinner"></span>
    </button>

  </form>
</div>
