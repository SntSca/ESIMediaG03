<!-- Header del usuario -->
<div class="usuario-header">
  <div class="usuario-info">
    <div class="avatar">{{ userInitials }}</div>
    <div class="datos">
      <div class="nombre">{{ userName }}</div>
      <div class="email">{{ userEmail }}</div>
    </div>
  </div>
  <button class="btn-cerrar" (click)="cerrarSesion()">Cerrar sesión</button>
</div>

<!-- Barra de filtros -->
<div class="filtros">
  <input type="text" [(ngModel)]="filtros.titulo" placeholder="Buscar por título" (input)="aplicarFiltros()" />
  <select [(ngModel)]="filtros.tipo" (change)="aplicarFiltros()">
    <option value="">Todos los tipos</option>
    <option value="AUDIO">Audio</option>
    <option value="VIDEO">Video</option>
  </select>
  <select [(ngModel)]="filtros.vip" (change)="aplicarFiltros()">
    <option value="">VIP / No VIP</option>
    <option value="si">VIP</option>
    <option value="no">No VIP</option>
  </select>
  <select [(ngModel)]="filtros.visible" (change)="aplicarFiltros()">
    <option value="">Visible / No visible</option>
    <option value="si">Visible</option>
    <option value="no">No visible</option>
  </select>
  <input type="text" [(ngModel)]="filtros.tagIncluye" placeholder="Buscar por tag" (input)="aplicarFiltros()" />
  <select [(ngModel)]="filtros.ordenar" (change)="aplicarFiltros()">
    <option value="fecha">Ordenar por fecha</option>
    <option value="titulo">Ordenar por título</option>
    <option value="vip">Ordenar por VIP</option>
    <option value="visible">Ordenar por visibilidad</option>
  </select>
</div>

<!-- Pestañas principales -->
<div class="tabs">
  <button class="tab-btn" [class.active]="selectedTab==='ALL'" (click)="setTab('ALL')">Todos</button>
  <button class="tab-btn" [class.active]="selectedTab==='AUDIO'" (click)="setTab('AUDIO')">Audio</button>
  <button class="tab-btn" [class.active]="selectedTab==='VIDEO'" (click)="setTab('VIDEO')">Video</button>
  <button class="tab-btn" [class.active]="selectedTab==='HIST'" (click)="setTab('HIST')">Historial</button>
  <button class="tab-btn" [class.active]="selectedTab==='FAV'" (click)="setTab('FAV')">Favoritos</button>
</div>

<!-- Subpestañas solo para Historial / Favoritos (sin "Todos") -->
<div class="subtabs" *ngIf="selectedTab==='HIST' || selectedTab==='FAV'">
  <button class="subtab-btn" [class.active]="selectedSubTab==='AUDIO'" (click)="setSubTab('AUDIO')">Audio</button>
  <button class="subtab-btn" [class.active]="selectedSubTab==='VIDEO'" (click)="setSubTab('VIDEO')">Video</button>
</div>

<!-- Contenidos y carruseles con fondo de cuadrícula -->
<div class="contenidos grid-bg">
  <div *ngIf="loading">Cargando contenidos...</div>
  <div *ngIf="errorMsg" class="error">{{ errorMsg }}</div>
  <div *ngIf="!loading && !errorMsg && contenidosTab.length === 0">No hay contenidos disponibles</div>

  <!-- Recomendados -->
  <h2>Recomendados para ti</h2>
  <div class="rail" *ngIf="carruselRecomendados.length">
    <button class="rail-btn prev" (click)="scrollCarousel(railRec, 'prev')">‹</button>
    <div class="rail-track" #railRec>
      <div class="card" *ngFor="let c of carruselRecomendados">
        <button class="heart" [class.liked]="c.favorito" (click)="toggleFavorito(c)" aria-label="Favorito">
          <svg viewBox="0 0 24 24" class="heart-svg"><path d="M12 21s-7.5-4.35-9.6-8.33C.7 9.46 2.1 6 5.4 6c1.9 0 3.1 1 3.9 2 .8-1 2-2 3.9-2 3.3 0 4.7 3.46 3 6.67C19.5 16.65 12 21 12 21z"/></svg>
        </button>
        <div class="poster"><div class="poster-fallback">{{ getEmoji(c) }}</div></div>
        <div class="card-info">
          <div class="card-title">
            {{ c.titulo }}
            <span *ngIf="c.vip" class="chip chip-vip">VIP</span>
            <span class="chip chip-tipo">{{ c.tipo }}</span>
          </div>
          <div class="card-desc">{{ c.descripcion }}</div>
          <div class="card-meta">
            <span>{{ c.duracionMinutos }} min</span>
            <span *ngIf="c.resolucion">{{ c.resolucion }}</span>
            <span *ngIf="c.restringidoEdad">+18</span>
          </div>
          <div class="card-tags" *ngIf="c.tags?.length">
            <span class="tag" *ngFor="let t of c.tags">{{ t }}</span>
          </div>
        </div>
      </div>
    </div>
    <button class="rail-btn next" (click)="scrollCarousel(railRec, 'next')">›</button>
  </div>

  <!-- Populares -->
  <h2>Populares</h2>
  <div class="rail" *ngIf="carruselPopulares.length">
    <button class="rail-btn prev" (click)="scrollCarousel(railPop, 'prev')">‹</button>
    <div class="rail-track" #railPop>
      <div class="card" *ngFor="let c of carruselPopulares">
        <button class="heart" [class.liked]="c.favorito" (click)="toggleFavorito(c)" aria-label="Favorito">
          <svg viewBox="0 0 24 24" class="heart-svg"><path d="M12 21s-7.5-4.35-9.6-8.33C.7 9.46 2.1 6 5.4 6c1.9 0 3.1 1 3.9 2 .8-1 2-2 3.9-2 3.3 0 4.7 3.46 3 6.67C19.5 16.65 12 21 12 21z"/></svg>
        </button>
        <div class="poster"><div class="poster-fallback">{{ getEmoji(c) }}</div></div>
        <div class="card-info">
          <div class="card-title">
            {{ c.titulo }}
            <span *ngIf="c.vip" class="chip chip-vip">VIP</span>
            <span class="chip chip-tipo">{{ c.tipo }}</span>
          </div>
          <div class="card-desc">{{ c.descripcion }}</div>
          <div class="card-meta">
            <span>{{ c.duracionMinutos }} min</span>
            <span *ngIf="c.resolucion">{{ c.resolucion }}</span>
            <span *ngIf="c.restringidoEdad">+18</span>
          </div>
          <div class="card-tags" *ngIf="c.tags?.length">
            <span class="tag" *ngFor="let t of c.tags">{{ t }}</span>
          </div>
        </div>
      </div>
    </div>
    <button class="rail-btn next" (click)="scrollCarousel(railPop, 'next')">›</button>
  </div>

  <!-- Últimos añadidos -->
  <h2>Últimos añadidos</h2>
  <div class="rail" *ngIf="carruselUltimos.length">
    <button class="rail-btn prev" (click)="scrollCarousel(railNew, 'prev')">‹</button>
    <div class="rail-track" #railNew>
      <div class="card" *ngFor="let c of carruselUltimos">
        <button class="heart" [class.liked]="c.favorito" (click)="toggleFavorito(c)" aria-label="Favorito">
          <svg viewBox="0 0 24 24" class="heart-svg"><path d="M12 21s-7.5-4.35-9.6-8.33C.7 9.46 2.1 6 5.4 6c1.9 0 3.1 1 3.9 2 .8-1 2-2 3.9-2 3.3 0 4.7 3.46 3 6.67C19.5 16.65 12 21 12 21z"/></svg>
        </button>
        <div class="poster"><div class="poster-fallback">{{ getEmoji(c) }}</div></div>
        <div class="card-info">
          <div class="card-title">
            {{ c.titulo }}
            <span *ngIf="c.vip" class="chip chip-vip">VIP</span>
            <span class="chip chip-tipo">{{ c.tipo }}</span>
          </div>
          <div class="card-desc">{{ c.descripcion }}</div>
          <div class="card-meta">
            <span>{{ c.duracionMinutos }} min</span>
            <span *ngIf="c.resolucion">{{ c.resolucion }}</span>
            <span *ngIf="c.restringidoEdad">+18</span>
          </div>
          <div class="card-tags" *ngIf="c.tags?.length">
            <span class="tag" *ngFor="let t of c.tags">{{ t }}</span>
          </div>
        </div>
      </div>
    </div>
    <button class="rail-btn next" (click)="scrollCarousel(railNew, 'next')">›</button>
  </div>
</div>
