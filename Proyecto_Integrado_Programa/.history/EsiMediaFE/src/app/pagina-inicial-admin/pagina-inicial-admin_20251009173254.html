<div class="full-screen-wrapper">
  <div class="page-wrapper">
    <!-- üîπ Barra superior -->
    <nav class="navbar">
      <ul class="navbar-options">
        <li><a routerLink="/inicio">Inicio</a></li>
        <li><a routerLink="/usuarios" class="active">Usuarios</a></li>
        <li><a routerLink="/configuracion">Configuraci√≥n</a></li>
        <li><a routerLink="/ayuda">Ayuda</a></li>
      </ul>

      <div class="user-panel">
        <div class="user-photo">{{ userInitials }}</div>
        <div class="user-info">
          <div class="user-name">{{ userName }}</div>
          <div class="user-email">{{ userEmail }}</div>
          <div class="user-role">{{ userRole }}</div>
        </div>
        <button class="logout-btn" (click)="cerrarSesion()">Cerrar Sesi√≥n</button>
      </div>
    </nav>

    <div class="main-container">
      <!-- üîπ Panel lateral -->
      <aside class="filter-panel">
        <h3>Filtros</h3>
        <form #filtrosForm="ngForm" (ngSubmit)="aplicarFiltros()">
          <div class="filter-section">
            <label for="nombre">Por Nombre:</label>
            <input id="nombre" type="text" name="nombre" [(ngModel)]="filtros.nombre" placeholder="Buscar nombre...">
          </div>

          <div class="filter-section">
            <label for="bloqueado">Por Bloqueado:</label>
            <select id="bloqueado" name="bloqueado" [(ngModel)]="filtros.bloqueado">
              <option value="">Todos</option>
              <option value="si">S√≠</option>
              <option value="no">No</option>
            </select>
          </div>

          <button type="submit" class="filter-btn">Aplicar Filtros</button>
        </form>
      </aside>

      <!-- üîπ Contenido principal -->
      <main class="content-area">
        <!-- Estado de carga -->
        <div *ngIf="loading" class="loading-container">
          <p>Cargando usuarios...</p>
        </div>

        <!-- Error -->
        <div *ngIf="!loading && errorMsg" class="error-container">
          <p>{{ errorMsg }}</p>
        </div>

        <!-- Tabla de usuarios -->
        <table class="users-table" *ngIf="!loading && !errorMsg && usuariosMostrar.length > 0; else noUsers">
          <thead>
            <tr>
              <th>Foto</th>
              <th>Nombre</th>
              <th>Email</th>
              <th>Rol</th>
              <th>Tema</th>
              <th>Bloqueado</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let u of usuariosMostrar">
              <td>
                <!-- Generamos iniciales en el HTML -->
              </td>
              <td>{{ u.nombre }}</td>
              <td>{{ u.email }}</td>
              <td>{{ u.rol }}</td>
              <td>{{ u.tema }}</td>
              <td>{{ u.bloqueado ? 'S√≠' : 'No' }}</td>
              <td class="actions-cell">
                <button class="action-btn btn-edit" (click)="editar(u)">Editar</button>
                <button class="action-btn btn-block" (click)="bloquear(u)">
                  {{ u.bloqueado ? 'Desbloquear' : 'Bloquear' }}
                </button>
                <button class="action-btn btn-consult" (click)="consultar(u)">Consultar</button>
              </td>
            </tr>
          </tbody>
        </table>

        <!-- No hay usuarios -->
        <ng-template #noUsers>
          <p class="no-data">No hay usuarios que coincidan con los filtros.</p>
        </ng-template>
      </main>
    </div>

    <!-- üîπ Modal de usuario -->
    <div class="modal" *ngIf="modalAbierto">
      <div class="modal-content">
        <span class="close" (click)="cerrarModal()">&times;</span>
        <div class="modal-user-photo">
          {{ usuarioSeleccionado?.nombre ? (usuarioSeleccionado.nombre.split(' ').map(p => p[0]).join('').toUpperCase()) : '?' }}
        </div>
        <div class="modal-user-info">
          <p><strong>Nombre:</strong> {{ usuarioSeleccionado?.nombre }}</p>
          <p><strong>Email:</strong> {{ usuarioSeleccionado?.email }}</p>
          <p><strong>Rol:</strong> {{ usuarioSeleccionado?.rol }}</p>
          <p><strong>Tema:</strong> {{ usuarioSeleccionado?.tema }}</p>
          <p><strong>Bloqueado:</strong> {{ usuarioSeleccionado?.bloqueado ? 'S√≠' : 'No' }}</p>
        </div>
        <div class="modal-actions">
          <button class="action-btn btn-edit" (click)="editar(usuarioSeleccionado)">Editar</button>
          <button class="action-btn btn-block" (click)="usuarioSeleccionado && bloquear(usuarioSeleccionado)">
            {{ usuarioSeleccionado?.bloqueado ? 'Desbloquear' : 'Bloquear' }}
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
