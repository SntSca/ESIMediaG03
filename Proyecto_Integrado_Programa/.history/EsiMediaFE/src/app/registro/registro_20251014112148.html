<div class="auth-container">
  <h2>Crear Cuenta</h2>

  <form #f="ngForm" (ngSubmit)="onSubmit(f)">
    <!-- Nombre -->
    <input class="input"
      name="nombre"
      [(ngModel)]="nombre"
      required
      #nombreModel="ngModel"
      (ngModelChange)="0"
      [ngClass]="{
        'input-error': nombreModel.invalid && nombreModel.dirty,
        'input-valid': nombreModel.valid && nombreModel.dirty
      }"
      placeholder="Nombre *">
    <small class="error-msg" *ngIf="nombreModel.invalid && nombreModel.dirty">Falta el nombre</small>

    <!-- Apellidos -->
    <input class="input"
      name="apellidos"
      [(ngModel)]="apellidos"
      required
      #apellidosModel="ngModel"
      (ngModelChange)="0"
      [ngClass]="{
        'input-error': apellidosModel.invalid && apellidosModel.dirty,
        'input-valid': apellidosModel.valid && apellidosModel.dirty
      }"
      placeholder="Apellidos *">
    <small class="error-msg" *ngIf="apellidosModel.invalid && apellidosModel.dirty">Faltan los apellidos</small>

    <!-- Email -->
    <input class="input"
      type="email"
      name="email"
      [(ngModel)]="email"
      required
      [pattern]="emailPattern.source"
      #emailModel="ngModel"
      (ngModelChange)="0"
      [ngClass]="{
        'input-error': emailModel.invalid && emailModel.dirty,
        'input-valid': emailModel.valid && emailModel.dirty
      }"
      placeholder="Email *">
    <small class="error-msg" *ngIf="emailModel.errors?.['required'] && emailModel.dirty">Falta el email</small>
    <small class="error-msg" *ngIf="emailModel.errors?.['pattern'] && emailModel.dirty">Email no vÃ¡lido</small>

    <!-- Alias -->
    <input class="input"
      name="alias"
      [(ngModel)]="alias"
      placeholder="Alias (opcional)">

    <!-- Fecha nacimiento -->
    <input class="input"
      type="date"
      name="fechaNac"
      [(ngModel)]="fechaNac"
      required
      #fechaModel="ngModel"
      (ngModelChange)="0"
      [ngClass]="{
        'input-error': (fechaModel.invalid && fechaModel.dirty) || fechaInvalida,
        'input-valid': fechaModel.valid && !fechaInvalida
      }"
      placeholder="Fecha de nacimiento *">
    <small class="error-msg" *ngIf="fechaModel.errors?.['required'] && fechaModel.dirty">Falta la fecha</small>
    <small class="error-msg" *ngIf="fechaInvalida">La fecha no puede ser futura</small>

    <!-- Rol -->
    <select class="input role-select"
      name="role"
      [(ngModel)]="role"
      required
      #roleModel="ngModel"
      (ngModelChange)="0"
      [ngClass]="{
        'input-error': roleModel.invalid && roleModel.dirty,
        'input-valid': roleModel.valid && roleModel.dirty
      }">
      <option value="" disabled selected>Selecciona un rol *</option>
      <option value="usuario">Usuario</option>
      <option value="Gestor de Contenido">Gestor de Contenido</option>
      <option value="Administrador">Administrador</option>
    </select>
    <small class="error-msg" *ngIf="roleModel.invalid && roleModel.dirty">Selecciona un rol</small>

    <!-- ContraseÃ±a -->
    <div class="password-field">
      <input class="input"
        [type]="showPwd ? 'text' : 'password'"
        name="pwd"
        [(ngModel)]="pwd"
        required
        minlength="8"
        #pwdModel="ngModel"
        (ngModelChange)="onPwdChange()"
        [ngClass]="{
          'input-error': (pwdModel.invalid && pwdModel.dirty) || (pwdModel.dirty && pwdIssues.length>0),
          'input-valid': pwdModel.valid && pwdIssues.length==0
        }"
        placeholder="ContraseÃ±a *">
      <button type="button" class="toggle-eye" (click)="togglePwd()">{{ showPwd ? 'ğŸ™ˆ' : 'ğŸ‘ï¸' }}</button>
    </div>

    <ul class="error-list" *ngIf="pwdModel.dirty && pwdIssues.length">
      <li *ngFor="let r of pwdIssues" class="error-msg">â€¢ {{ r }}</li>
    </ul>

    <!-- Repetir contraseÃ±a -->
    <div class="password-field">
      <input class="input"
        [type]="showPwd2 ? 'text' : 'password'"
        name="pwd2"
        [(ngModel)]="pwd2"
        required
        #pwd2Model="ngModel"
        (ngModelChange)="0"
        [ngClass]="{
          'input-error': (pwd2Model.invalid && pwd2Model.dirty) || (pwd2Model.dirty && pwdMismatch),
          'input-valid': pwd2Model.valid && !pwdMismatch
        }"
        placeholder="Repetir ContraseÃ±a *">
      <button type="button" class="toggle-eye" (click)="togglePwd2()">{{ showPwd2 ? 'ğŸ™ˆ' : 'ğŸ‘ï¸' }}</button>
    </div>
    <small class="error-msg" *ngIf="pwdMismatch">Las contraseÃ±as no coinciden</small>

    <!-- Avatar -->
    <button type="button" class="btn" (click)="openAvatarModal()">Elegir Avatar</button>
    <div *ngIf="selectedAvatar" class="selected-avatar">
      <img [src]="selectedAvatar" alt="avatar" width="70">
    </div>

    <!-- VIP -->
    <label class="chkline">
      <input type="checkbox" [(ngModel)]="vip" name="vip"> Â¿Quiere ser VIP?
    </label>

    <!-- TÃ©rminos -->
    <label class="chkline terms">
      <input type="checkbox" [(ngModel)]="termsAccepted" name="termsAccepted" required>
      Acepto los <a href="#">TÃ©rminos</a> y la <a href="#">PolÃ­tica de Privacidad</a> *
    </label>

    <button class="btn"
      type="submit"
      [disabled]="isLoading || f.invalid || pwdIssues.length>0 || pwdMismatch || fechaInvalida || !termsAccepted">
      <span *ngIf="!isLoading">Registrar</span>
      <span *ngIf="isLoading" class="spinner"></span>
    </button>
  </form>
</div>

<div *ngIf="showAvatarModal" class="avatar-modal">
  <div class="avatar-modal-content">
    <h3>Elige tu avatar</h3>
    <div class="avatar-grid">
      <div *ngFor="let avatar of avatars"
           class="avatar-option"
           [class.selected]="selectedAvatar === avatar"
           (click)="selectAvatar(avatar)"
           (keydown.enter)="selectAvatar(avatar)">
        <img [src]="avatar" alt="avatar">
      </div>
    </div>
    <button class="close-modal" (click)="closeAvatarModal()">Cerrar</button>
  </div>
</div>
