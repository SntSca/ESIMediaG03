<div class="auth-fullscreen">

  <div class="auth-box-wrapper">

    <!-- Secci√≥n izquierda: descripci√≥n y carrusel -->
    <div class="auth-left">
      <h2>Bienvenido a ESIMedia</h2>
      <p>
        La experiencia de streaming definitiva: disfruta de pel√≠culas, series, documentales, m√∫sica y p√≥dcasts en un mismo lugar. 
        Accede a un cat√°logo variado de contenidos multimedia con la mejor calidad de imagen y sonido, disponible en cualquier 
        dispositivo y en cualquier momento. Personaliza tu experiencia, descubre nuevas recomendaciones y comparte tus favoritos 
        con amigos y comunidad.
      </p>

      <!-- Carrusel de fotos -->
      <div class="carousel-container">
        <button class="carousel-btn left" (click)="prev()">‚Äπ</button>
        <div class="carousel-viewport">
          <div class="carousel-inner" [style.transform]="'translateX(-' + (currentIndex * 100) + '%)'">
            <img *ngFor="let foto of fotos" [src]="foto" alt="Foto de pel√≠cula">
          </div>
        </div>
        <button class="carousel-btn right" (click)="next()">‚Ä∫</button>
      </div>
    </div>

    <!-- Secci√≥n derecha: formulario de registro -->
    <div class="auth-card">
      <h2>Crear Cuenta</h2>

      <form #f="ngForm" (ngSubmit)="onSubmit(f)">

        <!-- Nombre -->
        <input class="input"
               name="nombre"
               [(ngModel)]="nombre"
               required
               #nombreModel="ngModel"
               [disabled]="isLoading"
               [ngClass]="{'input-error': nombreModel.invalid && nombreModel.dirty}"
               placeholder="Nombre *">
        <small class="error-msg" *ngIf="nombreModel.invalid && nombreModel.dirty">Falta el nombre</small>

        <!-- Apellidos -->
        <input class="input"
               name="apellidos"
               [(ngModel)]="apellidos"
               required
               #apellidosModel="ngModel"
               [disabled]="isLoading"
               [ngClass]="{'input-error': apellidosModel.invalid && apellidosModel.dirty}"
               placeholder="Apellidos *">
        <small class="error-msg" *ngIf="apellidosModel.invalid && apellidosModel.dirty">Faltan los apellidos</small>

        <!-- Email -->
        <input class="input"
               name="email"
               type="email"
               [(ngModel)]="email"
               required
               [pattern]="emailPattern.source"
               #emailModel="ngModel"
               [disabled]="isLoading"
               [ngClass]="{'input-error': emailModel.invalid && emailModel.dirty}"
               placeholder="Email *">
        <small class="error-msg" *ngIf="emailModel.errors?.['required'] && emailModel.dirty">Falta el email</small>
        <small class="error-msg" *ngIf="emailModel.errors?.['pattern'] && emailModel.dirty">Email no v√°lido</small>

        <!-- Alias -->
        <input class="input" name="alias" [(ngModel)]="alias" [disabled]="isLoading" placeholder="Alias (opcional)">

        <!-- Fecha de nacimiento -->
        <input class="input"
               name="fechaNac"
               type="date"
               [(ngModel)]="fechaNac"
               required
               #fechaModel="ngModel"
               [disabled]="isLoading"
               [ngClass]="{'input-error': (fechaModel.invalid && fechaModel.dirty) || (fechaModel.dirty && fechaInvalida)}"
               placeholder="Fecha Nacimiento *">
        <small class="error-msg" *ngIf="fechaModel.errors?.['required'] && fechaModel.dirty">Falta la fecha de nacimiento</small>
        <small class="error-msg" *ngIf="fechaModel.dirty && fechaInvalida">La fecha no puede ser futura</small>

        <!-- Rol -->
        <select class="input role-select"
                name="role"
                [(ngModel)]="role"
                required
                #roleModel="ngModel"
                [disabled]="isLoading"
                [ngClass]="{'input-error': roleModel.invalid && roleModel.dirty}">
          <option value="" disabled selected>Selecciona un rol *</option>
          <option value="usuario">Usuario</option>
          <option value="Gestor de Contenido">Gestor de Contenido</option>
          <option value="Administrador">Administrador</option>
        </select>
        <small class="error-msg" *ngIf="roleModel.invalid && roleModel.dirty">Selecciona un rol</small>

        <!-- Contrase√±a -->
        <div class="password-field">
          <input class="input"
                 [type]="showPwd ? 'text' : 'password'"
                 name="pwd"
                 [(ngModel)]="pwd"
                 required
                 minlength="8"
                 #pwdModel="ngModel"
                 [disabled]="isLoading"
                 [ngClass]="{'input-error': (pwdModel.invalid && pwdModel.dirty) || (pwdModel.dirty && pwdIssues.length>0)}"
                 placeholder="Contrase√±a *">
          <button type="button" class="toggle-eye" (click)="togglePwd()" [disabled]="isLoading">
            {{ showPwd ? 'üôà' : 'üëÅÔ∏è' }}
          </button>
        </div>
        <small class="error-msg" *ngIf="pwdModel.errors?.['required'] && pwdModel.dirty">Falta la contrase√±a</small>

        <ul class="error-list" *ngIf="pwdModel.dirty && pwdIssues.length">
          <li *ngFor="let r of pwdIssues" class="error-msg">‚Ä¢ {{ r }}</li>
        </ul>
        <div class="strength-wrapper" *ngIf="pwd.length">
          <div class="strength-bar" [class.s1]="pwdScore===1" [class.s2]="pwdScore===2"
               [class.s3]="pwdScore===3" [class.s4]="pwdScore===4"></div>
          <small class="strength-label">Fuerza: {{ pwdStrengthLabel }}</small>
        </div>

        <small class="info-msg" *ngIf="isCheckingPwned && pwd.length">Comprobando contrase√±a...</small>
        <small class="error-msg" *ngIf="!isCheckingPwned && (pwnedCount || 0) > 0">
          Esta contrase√±a aparece en filtraciones {{ pwnedCount }} veces. Elige otra distinta.
        </small>
        <small class="ok-msg" *ngIf="!isCheckingPwned && pwd.length && pwnedCount === 0">
          Esta contrase√±a no aparece en el diccionario de contrase√±as comprometidas.
        </small>

        <!-- Repetir contrase√±a -->
        <div class="password-field">
          <input class="input"
                 [type]="showPwd2 ? 'text' : 'password'"
                 name="pwd2"
                 [(ngModel)]="pwd2"
                 required
                 #pwd2Model="ngModel"
                 [disabled]="isLoading"
                 [ngClass]="{'input-error': (pwd2Model.invalid && pwd2Model.dirty) || (pwd2Model.dirty && pwdMismatch)}"
                 placeholder="Repetir Contrase√±a *">
          <button type="button" class="toggle-eye" (click)="togglePwd2()" [disabled]="isLoading">
            {{ showPwd2 ? 'üôà' : 'üëÅÔ∏è' }}
          </button>
        </div>
        <small class="error-msg" *ngIf="pwd2Model.errors?.['required'] && pwd2Model.dirty">Falta confirmar la contrase√±a</small>
        <small class="error-msg" *ngIf="pwd2Model.dirty && pwdMismatch">Las contrase√±as no coinciden</small>

        <!-- VIP -->
        <label class="chkline">
          <input type="checkbox" [(ngModel)]="vip" name="vip" [disabled]="isLoading">
          ¬øQuiere usted ser VIP?
        </label>

        <!-- Foto -->
        <div class="file-upload">
          <label for="foto">Foto de perfil (m√°x 2MB):</label>
          <input type="file" id="foto" (change)="onFileChange($event)" [disabled]="isLoading">
        </div>

        <!-- T√©rminos -->
        <label class="chkline terms">
          <input type="checkbox" [(ngModel)]="termsAccepted" name="termsAccepted" [disabled]="isLoading" required>
          Acepto los <a href="#" target="_blank">T√©rminos</a> y la <a href="#" target="_blank">Pol√≠tica de Privacidad</a> *
        </label>

        <!-- Bot√≥n -->
        <button class="btn" type="submit"
                [disabled]="isLoading || f.invalid || pwdIssues.length>0 || pwdMismatch || fechaInvalida || !termsAccepted">
          <span *ngIf="!isLoading">Registrar</span>
          <span *ngIf="isLoading" class="spinner"></span>
        </button>

      </form>
    </div>

  </div>

</div>
