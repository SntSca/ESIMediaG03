<div class="auth-container">
  <h2>Crear Cuenta</h2>

  <form #f="ngForm" (ngSubmit)="onSubmit(f)">
    <!-- NOMBRE -->
    <div class="field-group">
      <input class="input"
             name="nombre"
             [(ngModel)]="nombre"
             required
             #nombreModel="ngModel"
             [disabled]="isLoading"
             [ngClass]="{
               'input-error': nombreModel.invalid && nombreModel.dirty,
               'input-valid': nombreModel.valid && nombreModel.dirty
             }"
             placeholder="Nombre *">
      <small class="error-msg" *ngIf="nombreModel.invalid && nombreModel.dirty">Falta el nombre</small>
    </div>

    <!-- APELLIDOS -->
    <div class="field-group">
      <input class="input"
             name="apellidos"
             [(ngModel)]="apellidos"
             required
             #apellidosModel="ngModel"
             [disabled]="isLoading"
             [ngClass]="{
               'input-error': apellidosModel.invalid && apellidosModel.dirty,
               'input-valid': apellidosModel.valid && apellidosModel.dirty
             }"
             placeholder="Apellidos *">
      <small class="error-msg" *ngIf="apellidosModel.invalid && apellidosModel.dirty">Faltan los apellidos</small>
    </div>

    <!-- EMAIL -->
    <div class="field-group">
      <input class="input"
             name="email"
             type="email"
             [(ngModel)]="email"
             required
             [pattern]="emailPattern.source"
             #emailModel="ngModel"
             [disabled]="isLoading"
             [ngClass]="{
               'input-error': emailModel.invalid && emailModel.dirty,
               'input-valid': emailModel.valid && emailModel.dirty
             }"
             placeholder="Email *">
      <small class="error-msg" *ngIf="emailModel.errors?.['required'] && emailModel.dirty">Falta el email</small>
      <small class="error-msg" *ngIf="emailModel.errors?.['pattern'] && emailModel.dirty">Email no vÃ¡lido</small>
    </div>

    <!-- ALIAS -->
    <div class="field-group">
      <input class="input" name="alias" [(ngModel)]="alias" [disabled]="isLoading" placeholder="Alias (opcional)">
    </div>

    <!-- FECHA NACIMIENTO -->
    <div class="field-group">
      <input class="input"
             name="fechaNac"
             type="date"
             [(ngModel)]="fechaNac"
             required
             #fechaModel="ngModel"
             [disabled]="isLoading"
             [ngClass]="{
               'input-error': (fechaModel.invalid && fechaModel.dirty) || (fechaModel.dirty && fechaInvalida),
               'input-valid': fechaModel.valid && !fechaInvalida && fechaModel.dirty
             }">
      <small class="error-msg" *ngIf="fechaModel.errors?.['required'] && fechaModel.dirty">Falta la fecha</small>
      <small class="error-msg" *ngIf="fechaModel.dirty && fechaInvalida">La fecha no puede ser futura</small>
    </div>

    <!-- ROL -->
    <div class="field-group">
      <select class="input role-select"
              name="role"
              [(ngModel)]="role"
              required
              #roleModel="ngModel"
              [disabled]="isLoading"
              [ngClass]="{
                'input-error': roleModel.invalid && roleModel.dirty,
                'input-valid': roleModel.valid && roleModel.dirty
              }">
        <option value="" disabled selected>Selecciona un rol *</option>
        <option value="usuario">Usuario</option>
        <option value="Gestor de Contenido">Gestor de Contenido</option>
        <option value="Administrador">Administrador</option>
      </select>
      <small class="error-msg" *ngIf="roleModel.invalid && roleModel.dirty">Selecciona un rol</small>
    </div>

    <!-- CONTRASEÃ‘A -->
    <div class="field-group password-field">
      <input class="input"
             [type]="showPwd ? 'text' : 'password'"
             name="pwd"
             [(ngModel)]="pwd"
             required minlength="8"
             #pwdModel="ngModel"
             [disabled]="isLoading"
             [ngClass]="{
               'input-error': (pwdModel.invalid && pwdModel.dirty) || (pwdModel.dirty && pwdIssues.length>0),
               'input-valid': pwdModel.valid && pwdIssues.length===0 && pwdModel.dirty
             }"
             (input)="onPwdChange()"
             placeholder="ContraseÃ±a *">
      <button type="button" class="toggle-eye" (click)="togglePwd()" [disabled]="isLoading">{{ showPwd ? 'ğŸ™ˆ' : 'ğŸ‘ï¸' }}</button>
    </div>
    <ul class="error-list" *ngIf="pwdModel.dirty && pwdIssues.length">
      <li *ngFor="let r of pwdIssues" class="error-msg">â€¢ {{ r }}</li>
    </ul>

    <!-- REPETIR CONTRASEÃ‘A -->
    <div class="field-group password-field">
      <input class="input"
             [type]="showPwd2 ? 'text' : 'password'"
             name="pwd2"
             [(ngModel)]="pwd2"
             required
             #pwd2Model="ngModel"
             [disabled]="isLoading"
             [ngClass]="{
               'input-error': (pwd2Model.invalid && pwd2Model.dirty) || (pwd2Model.dirty && pwdMismatch),
               'input-valid': pwd2Model.valid && !pwdMismatch && pwd2Model.dirty
             }"
             placeholder="Repetir ContraseÃ±a *">
      <button type="button" class="toggle-eye" (click)="togglePwd2()" [disabled]="isLoading">{{ showPwd2 ? 'ğŸ™ˆ' : 'ğŸ‘ï¸' }}</button>
    </div>
    <small class="error-msg" *ngIf="pwd2Model.dirty && pwdMismatch">Las contraseÃ±as no coinciden</small>

    <!-- VIP -->
    <label class="chkline">
      <input type="checkbox" [(ngModel)]="vip" name="vip" [disabled]="isLoading">
      Â¿Quiere usted ser VIP?
    </label>

    <!-- FOTO DE PERFIL -->
    <div class="field-group avatar-section">
      <button type="button" class="btn-secondary" (click)="openAvatarModal()" [disabled]="isLoading">Elegir avatar</button>
      <img *ngIf="selectedAvatar" [src]="selectedAvatar" class="selected-avatar" alt="Avatar seleccionado">
    </div>

    <!-- MODAL DE AVATARES -->
    <div class="modal-backdrop" *ngIf="showAvatarModal" (click)="closeAvatarModal()"></div>
    <div class="avatar-modal" *ngIf="showAvatarModal">
      <h3>Elige tu avatar</h3>
      <div class="avatar-grid">
        <img *ngFor="let avatar of avatars"
             [src]="avatar"
             (click)="selectAvatar(avatar)"
             [class.selected]="avatar === selectedAvatar"
             alt="Avatar">
      </div>
      <button class="btn" type="button" (click)="closeAvatarModal()">Cerrar</button>
    </div>

    <!-- TÃ‰RMINOS -->
    <label class="chkline terms">
      <input type="checkbox" [(ngModel)]="termsAccepted" name="termsAccepted" [disabled]="isLoading" required>
      Acepto los <a href="#" target="_blank">TÃ©rminos</a> y la <a href="#" target="_blank">PolÃ­tica de Privacidad</a> *
    </label>

    <!-- BOTÃ“N REGISTRAR -->
    <button class="btn" type="submit"
            [disabled]="isLoading || f.invalid || pwdIssues.length>0 || pwdMismatch || fechaInvalida || !termsAccepted">
      <span *ngIf="!isLoading">Registrar</span>
      <span *ngIf="isLoading" class="spinner"></span>
    </button>
  </form>
</div>
