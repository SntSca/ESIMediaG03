<!-- Modal Avatares (accesible + SonarLint OK) -->
<div
  *ngIf="showAvatarModal"
  class="avatar-modal"
  tabindex="0"
  (click)="closeAvatarModal()"
  (keydown.enter)="closeAvatarModal()"
  (keydown.space)="closeAvatarModal()"
  (keydown.escape)="closeAvatarModal()">

  <!-- Usa <dialog> en lugar de role="dialog" -->
  <dialog
    class="avatar-modal-content"
    open
    aria-labelledby="avatarTitle"
    (click)="$event.stopPropagation()">

    <div class="avatar-modal-header">
      <h3 id="avatarTitle">Elige tu avatar</h3>
      <button class="avatar-close" type="button" aria-label="Cerrar" (click)="closeAvatarModal()">✕</button>
    </div>

    <!-- Preview grande del seleccionado -->
    <div class="avatar-preview" *ngIf="selectedAvatar; else noPreview">
      <img [src]="selectedAvatar" alt="avatar seleccionado">
      <div class="avatar-preview__caption">Seleccionado</div>
    </div>
    <ng-template #noPreview>
      <div class="avatar-preview avatar-preview--placeholder">
        <span>Selecciona uno de la galería</span>
      </div>
    </ng-template>

    <!-- Usa <ul>/<li> en lugar de roles de lista -->
    <ul class="avatar-grid">
      <li class="avatar-item" *ngFor="let avatar of avatars" [class.selected]="selectedAvatar === avatar">
        <button
          type="button"
          class="avatar-option"
          (click)="selectAvatar(avatar)"
          (keydown.enter)="selectAvatar(avatar)"
          [attr.aria-pressed]="selectedAvatar === avatar"
          [attr.aria-label]="'Elegir avatar ' + avatar">
          <img [src]="avatar" alt="avatar">
          <span class="avatar-check">✓</span>
        </button>
      </li>
    </ul>

    <div class="avatar-modal-actions">
      <button class="btn btn--ghost" type="button" (click)="closeAvatarModal()">Cancelar</button>
      <button class="btn" type="button" (click)="closeAvatarModal()">Usar este</button>
    </div>
  </dialog>
</div>
